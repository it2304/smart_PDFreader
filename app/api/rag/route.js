import { Pinecone } from "@pinecone-database/pinecone";
import { OpenAIEmbeddings } from "@langchain/openai";
import { OpenAI } from "openai";

const manualEmbedding = [-0.0188325047, -0.0330597945, 0.055159688, -0.0161182582, 0.0165041704, 0.0101623498, 0.0315933302, 0.053255856, 0.00164012599, -0.0225758515, 0.0221899394, 0.0379222855, -0.0802696943, -0.018652413, 0.0396974795, 0.0456662551, -0.0107154902, 0.00229939236, -0.033265613, -0.0188067779, -0.00460200058, -0.0301011354, 0.00652512861, 0.0134554654, 0.046103619, 0.0094934348, -0.0528442152, -0.0693097934, -0.0131724626, 0.0450745225, 0.0326738842, -0.0467468053, 0.00685637, 0.00173178012, -0.0367388241, -0.0416013151, -0.03972321, 0.0233991314, 0.0299210437, -0.0194113739, -0.0196300577, 0.0194628295, -0.00544135924, 0.0346806236, -0.0194242373, -0.00247626868, 0.0192184169, -0.035298083, -0.00741594238, 0.0179320443, -0.0308986884, 0.0204919279, -0.00869588368, 0.0129409162, -0.00253737136, -0.040160574, 0.0294064954, -0.00135069201, -0.00372083485, -0.00216914713, 0.0137513308, -0.0420644097, 0.0235920865, 0.00941625237, 0.0407008529, 0.0248527322, -0.00885668, 0.0818133429, 0.00486249104, 0.0123749115, -0.00748669263, 0.0588129908, 0.0494224653, -0.0211865697, -0.000010162852, 0.00388806337, -0.0715738088, 0.0378451049, 0.0471069925, -0.0205305181, -0.0485477298, -0.0144073814, -0.0427847765, -0.00272711157, 0.0356068127, -0.0329826139, 0.0317991488, 0.000242400973, 0.0163240768, -0.0116416784, -0.0633924752, -0.0402634852, 0.0328539759, -0.00447014719, 0.00799481, 0.0063675479, -0.0885539427, 0.00321110943, -0.0636497512, -0.0194242373, 0.00791119598, -0.00389127946, 0.013789922, 0.00410353113, 0.046489533, 0.0426561385, 0.0405207612, -0.0450487956, -0.00983432401, 0.0149605218, 0.0166199431, 0.0512233861, -0.0696185231, 0.00537704071, 0.00762819406, 0.0314646922, -0.0579382554, 0.00608776184, -0.00297956215, 0.00504579954, -0.0201060157, -0.0149605218, 0.0171859469, -0.0224472154, 0.00611992134, -0.0200545602, -0.0362757295, 0.0200159699, -0.0372533724, -0.0614371896, 0.00286539667, 0.0142530166, 0.0233348124, -0.00641900301, 0.00779542234, -0.0335486159, 0.0151020233, 0.00482711615, 0.0137256039, 0.0273225699, 0.0196300577, 0.00810415205, 0.0222542584, 0.0475443602, -0.0380509235, 0.0489079133, 0.0244282298, 0.0103488732, -0.041369766, -0.0681777894, -0.0175204054, -0.00990507472, -0.0124327987, -0.0165298972, -0.00526126707, 0.00797551498, -0.00394595042, 0.0245697312, -0.00619710376, 0.0509661101, -0.0677661449, 0.0557256937, -0.0418843143, 0.0171473566, -0.00215145946, 0.0273482967, -0.0170830376, -0.0273740254, -0.0499884672, -0.0169672649, -0.0253801458, 0.0173017215, -0.0141886976, -0.0552111454, -0.0288147628, -0.0429134145, -0.0525612161, -0.0534616746, 0.0346548967, 0.0374591909, 0.00288630021, 0.0205819737, 0.0113329487, 0.00241034199, 0.00603630673, 0.0257274676, -0.00414212234, 0.000429327105, 0.00147048547, -0.0117188608, 0.00690782489, 0.0133654187, 0.0434794202, 0.0558286, 0.00104598235, 0.020620564, 0.021418117, -0.0209550224, -0.000113261151, 0.00987934694, -0.00714580389, 0.0112686306, 0.0240809098, 0.0231804475, -0.0195657387, 0.000166022553, -0.028248759, 0.00290237973, 0.0090625, 0.0081941979, 0.0118089076, 0.0419100448, -0.0648846701, 0.0249427799, -0.0221384857, -0.0181635916, -0.0281973034, 0.000919756945, 0.00460521644, 0.0475443602, 0.00134667207, 0.0166328065, 0.0648846701, 0.00437366916, 0.00523875561, -0.0214309804, 0.0126579134, -0.00929404702, 0.00243446161, -0.0629808381, 0.0248270053, 0.0497054644, -0.00812344719, 0.00589802163, -0.0230775382, 0.0249813702, 0.000886793598, -0.0514292046, -0.0350408107, -0.0172502659, -0.0612828247, -0.0231032651, -0.00805269741, 0.0161053948, -0.0127543919, 0.0169415362, 0.00635790033, 0.0216496624, 0.049216643, 0.033394251, 0.0239265449, 0.0119761359, 0.0352209024, 0.018125, 0.0132882362, -0.00760889845, -0.0306414124, 0.0448429734, -0.0381023772, -0.0232447665, -0.00972498208, -0.0236949977, -0.00194081583, 0.0524840318, 0.00975714158, -0.0108183995, -0.00760889845, 0.0737863779, 0.0121112047, -0.00956418552, 0.0459235273, -0.0326738842, 0.040160574, 0.0268080197, -0.0483419113, 0.00759603456, 0.0246083215, 0.0332398862, -0.0602537282, 0.0455376171, -0.0222285315, -0.020749202, -0.00794335548, -0.0158738475, -0.0136484215, -0.00107010186, -0.000051454932, 0.036533, 0.0227302164, -0.032313697, 0.0578868, -0.0167357177, 0.0133911464, -0.013249645, -0.0229746271, 0.0126836412, 0.0312331449, -0.0291234925, 0.0125035485, 0.00612635305, 0.0143430624, -0.0198487397, 0.0266536549, 0.00830354, -0.0511204749, 0.0557256937, 0.0170315821, 0.0150377043, -0.0152177969, 0.0413183123, 0.0617973767, 0.0290977657, -0.00529985828, -0.0223443042, -0.0330855213, -0.0280686654, 0.073066, -0.0367388241, 0.0233090855, 0.0217911638, 0.0201703347, -0.0505287461, -0.0667370483, 0.0113972677, -0.00527091464, 0.0206977464, 0.0360699072, -0.0115452008, 0.0473642647, -0.0399290286, 0.0229617637, 0.00410353113, 0.0226787627, 0.0088373851, -0.0229489, 0.01247139, 0.00731946435, 0.054593686, -0.00818776619, -0.00448622694, 0.0186910052, -0.0612828247, -0.0143044712, -0.0167614445, 0.0287118535, -0.0235020407, 0.00422573648, -0.0379480124, 0.041498404, 0.00251646782, -0.0247112326, -0.0046405918, 0.0205691103, 0.0494996458, 0.0635983, 0.0431192331, 0.0596362688, -0.0249556433, -0.0284803063, 0.0206077, -0.0322622433, -0.000835338666, -0.0109599009, 0.0178805888, -0.0382310152, 0.0137513308, -0.0369703695, 0.0287118535, 0.00445085159, -0.0477759056, -0.0269366577, -0.0320564248, -0.0377936475, 0.0479559973, 0.0332398862, -0.039337296, -0.0105289659, 0.0175847244, 0.0506059267, -0.0171602201, 0.0424760468, 0.0386683829, -0.0367902778, 0.000467918289, 0.0193341915, -0.00217557885, -0.0194371, 0.00760889845, -0.006656982, -0.0447143354, 0.0384368338, -0.00756387506, -0.00749955652, 0.0258561037, 0.0327510647, 0.000529825047, 0.0286346711, 0.0325452462, -0.0175332688, -0.00649296958, -0.0298695881, -0.0331112482, 0.00841288175, -0.0538733155, -0.0207106099, 0.0235920865, -0.0110628111, 0.0423988663, -0.0210322049, -0.0367388241, 0.00126466574, 0.0118603623, 0.0296637695, -0.0076989443, -0.000527815078, -0.0152949793, -0.00765392138, 0.00217879494, 0.0173789039, 0.00518408464, -0.00277695851, 0.00553462142, 0.00463737594, -0.028660398, -0.00798194669, -0.0188582335, -0.0314389654, 0.00691425661, -0.00227044895, -0.0399033, -0.0278885737, -0.0138027864, -0.0116802696, -0.0108762868, 0.0300496817, -0.0259718783, -0.025135735, 0.0150248408, 0.0581440739, 0.00433507795, -0.0105353976, 0.0219455287, -0.0360699072, -0.0198101494, -0.0329568833, 0.00118185545, 0.0224858057, -0.0051004705, 0.0315676033, 0.0237850435, -0.0321336053, 0.027296843, 0.0354781784, -0.00778255891, -0.0196300577, -0.01188609, 0.0096220728, 0.0145231551, -0.0103553049, 0.0194371, -0.0306928679, -0.00295865862, 0.0369189158, 0.0146260653, 0.0194628295, 0.0157323461, 0.014870476, 0.00115210807, -0.0436337851, 0.00174303586, 0.0160539392, 0.0331627056, 0.0176747702, 0.000705093378, -0.0162211675, 0.0340631641, 0.0377164669, 0.00975071, 0.0171602201, -0.0114165638, 0.00890813582, 0.00329311565, -0.00832926761, -0.00697214343, -0.0536160395, 0.0114487223, -0.000773833948, -0.012124069, -0.0618488304, 0.00445085159, 0.0201960616, 0.0324937887, -0.00791762769, -0.0131853269, 0.0166971255, 0.0590702631, -0.0490622781, -0.0097635733, 0.0230646748, -0.0225501247, 0.00549603, -0.0254701916, 0.0343204401, 0.0191798266, 0.0319535136, 0.00336708222, -0.0096220728, -0.00628071791, -0.028660398, 0.0298438612, 0.0375363752, -0.0217783, -0.00542849535, -0.022305714, 0.0111657204, 0.0241195, 0.0323908813, 0.0320821516, -0.0499627404, 0.0328797027, -0.00595269259, 0.00416141795, 0.0357869044, -0.0173145849, 0.00835499447, 0.0171602201, -0.00919113774, -0.047698725, 0.0124906851, -0.0374591909, 0.0182150472, -0.0266793836, -0.029483676, 0.0472356305, -0.00128476531, 0.00863799732, 0.0116545428, 0.00351501512, -0.0288147628, 0.0141886976, 0.0432221442, -0.0241066366, 0.0176490415, -0.0407008529, -0.0237979069, 0.0164655782, 0.0363271832, 0.0263449252, -0.0324937887, -0.00257917843, 0.029740952, 0.0298695881, -0.0421158634, 0.0106961941, -0.0215467531, -0.0000760266776, -0.000810817175, -0.00559894, 0.0177648161, -0.0115709286, 0.00545422314, -0.0188325047, -0.000636352808, 0.0220998935, -0.0152692515, 0.0130824167, -0.0467468053, -0.0082906764, -0.0120018637, -0.00167550123, -0.0129730748, -0.0250199605, -0.00930691138, -0.0109341731, -0.0168772191, 0.033908803, -0.0516350269, 0.00993723422, -0.00889527146, 0.00613600062, -0.0066055269, 0.0200288333, -0.00400062092, -0.0431192331, -0.00405850774, 0.0429905951, -0.022781672, -0.0185109116, -0.0220355745, -0.0035761178, -0.00317251822, 0.0374077372, 0.00290720374, -0.0158352554, 0.025611693, 0.00840645, 0.0222285315, 0.0404693037, 0.00937122945, -0.00457305741, 0.0291234925, -0.00000217326738, -0.0211994331, 0.0330597945, 0.00646081, 0.0526126698, 0.0254959203, -0.0392343886, -0.000924580847, 0.0178677253, 0.00644151447, -0.00758960284, -0.00453768205, -0.0183565468, 0.0153978886, 0.0202989709, -0.0524583049, -0.0198358763, -0.0223957598, 0.0210450683, -0.0360184535, -0.0132625094, 0.00321914931, 0.00824565347, 0.025611693, 0.0583498962, 0.013075985, -0.0248527322, 0.0516864806, 0.0382824689, 0.0299725, -0.0286861248, -0.00177680317, -0.0338573456, -0.0486763678, 0.00926832, -0.00558607606, 0.00542206364, 0.00490429858, -0.0357354507, 0.000869909942, 0.0123813432, -0.00427719112, -0.0305899587, 0.0420386791, -0.0230003558, -0.0116223833, -0.0199130587, -0.00138365536, 0.0114422906, -0.0289948545, 0.00550889364, 0.0352466293, -0.0202989709, 0.0131145762, -0.00104437431, -0.0309758708, 0.0415241309, -0.0239136796, -0.0197844226, -0.0000470079, -0.0218040273, -0.0236949977, 0.0312331449, 0.00608776184, 0.00148334925, -0.0406236686, 0.0127415275, 0.00708791707, 0.0215853453, -0.0347063541, 0.0254573282, -0.00440582866, 0.00648975326, 0.0265764724, -0.0185366403, -0.0128508694, -0.0195914656, -0.021829756, 0.0101880766, -0.0668399557, 0.0425532311, -0.0354009941, -0.0113586765, 0.0115709286, -0.005155141, 0.0138799679, -0.0159638934, 0.0186266862, 0.0240294542, -0.011628815, -0.00525161903, 0.0406494, 0.00108939747, 0.0341146216, -0.0564460605, 0.0236178152, -0.00866372418, 0.0188710969, 0.003285076, 0.0343976244, -0.0220484398, 0.00198101485, -0.0296637695, -0.0250714161, -0.000294458907, 0.00530629, -0.00536417682, 0.0186395496, 0.0106061483, 0.0177905429, -0.0141629707, 0.0228202622, -0.0252129175, 0.0147289746, 0.0487278216, -0.0263320617, 0.0257274676, 0.000792325591, -0.00944198, 0.0597391762, 0.0322365165, -0.0429648682, -0.00859940611, -0.0103424415, 0.000571632176, 0.0206462927, 0.0244025029, 0.0031146314, -0.0232061744, -0.0137513308, -0.0136226937, -0.0148833394, -0.0162211675, 0.0126772095, 0.00228009676, 0.00307282433, -0.000807199278, 0.0120919095, 0.00446693134, 0.0320821516, -0.00488500297, -0.0176619068, -0.0370218232, 0.0102202361, 0.0426818691, 0.0299725, 0.00632574083, -0.0288404897, -0.00804626476, -0.0148576116, 0.0107991043, 0.0273740254, -0.0087409066, 0.0160668027, -0.0241966825, -0.00248109247, -0.00127511763, -0.0162211675, -0.0033188432, -0.0221256223, 0.00255666696, -0.0209550224, 0.0503743812, 0.0105032381, 0.0171087645, -0.014394518, -0.0157966651, 0.0397746637, 0.00903677288, -0.0250585526, 0.0424245931, -0.0237335879, 0.0320049673, 0.0152949793, -0.00684350636, -0.0165041704, -0.0102716908, -0.00492681, 0.012902325, -0.0373305529, -0.0114101311, -0.00921043288, -0.0197844226, -0.00803983305, -0.0563431531, 0.0584013499, -0.0223957598, -0.00476601301, -0.0266022012, -0.0207749289, -0.0380251966, -0.0370475538, -0.0144331092, 0.0105353976, 0.0274769347, 0.0098278923, -0.0658108592, -0.0133525552, 0.0146775199, 0.00152756833, -0.00257917843, -0.0591217168, -0.0489336401, 0.00925545581, -0.0101044625, -0.0312074181, 0.060150817, 0.00712007657, -0.0467982627, -0.0103231464, -0.02853176, -0.0246597771, 0.0136612849, 0.0319277868, -0.00195207156, 0.0232190378, -0.035298083, 0.0330597945, 0.0259204227, 0.0382824689, -0.00816847105, 0.000418473326, -0.0230260827, 0.00534166535, 0.0347578079, -0.00382696069, -0.0165684894, 0.00683064247, 0.0320821516, -0.0269881133, 0.0193084646, -0.0104646469, -0.0122784339, 0.00264992914, 0.000918148959, 0.0000864282119, 0.0357097238, -0.0228974447, 0.00624212669, 0.0376392826, 0.00101301901, 0.0368674584, 0.0149476584, 0.012169092, 0.00981502887, 0.0242738649, 0.0202475172, 0.0123105925, 0.0465409867, -0.0184465945, 0.00606846623, -0.0090753641, -0.0142401531, 0.0252772365, 0.00470169447, -0.0234248582, 0.0364300944, 0.00364365242, -0.00891456753, 0.0186266862, 0.00464380765, 0.0000155018042, 0.0216496624, -0.000890813535, -0.00058369193, -0.00637398, -0.02649929, 0.0235920865, 0.0231418572, -0.0135712391, -0.0309244152, -0.0171859469, -0.0157194827, 0.0295865871, 0.0335743427, -0.0399290286, 0.0235534962, -0.00670200493, -0.000471536216, 0.0115066096, -0.00217397092, 0.00717153121, 0.0113458131, 0.0091075236, 0.015346434, -0.0289434, 0.0245440025, 0.00538668828, 0.0249170512, 0.0196557846, 0.0262677427, 0.0318506025, 0.0122398427, 0.0486763678, -0.0411382206, -0.0148833394, 0.0267051104, -0.00473063812, 0.0368160047, -0.0446371548, 0.0122912973, 0.0417042226, 0.0405979417, -0.0156165725, 0.0355810858, 0.0147161111, 0.00640935497, -0.0230518095, 0.0245440025, 0.0747640207, 0.0111206975, 0.0293807667, -0.035426721, 0.00434472598, 0.00575008895, -0.000767402118, -0.0223828964, -0.0149219306, 0.00953845866, -0.0369446427, -0.0023733587, 0.0124778217, 0.000143611527, -0.0231032651, -0.0182407741, -0.0344490781, 0.000988899497, 0.032442335, -0.00549281435, -0.0183436833, 0.0424245931, -0.00963493623, 0.0464123487, -0.00232351176, 0.0510690212, 0.0203632899, -0.0119439764, -0.0181893185, 0.0192441456, -0.0213152058, 0.0184851848, -0.00163851806, -0.0187681876, 0.034732081, 0.00870231539, 0.00945484359, 0.00494610565, -0.00518408464, -0.00753814774, 0.0308472328, 0.0341146216, -0.00257113879, -0.0179577712, 0.0100465761, 0.0264735632, -0.0158352554, -0.00436723744, 0.0418843143, -0.0097957328, -0.0111914482, 0.0126579134, -0.040546488, 0.0114229955, 0.0218554828, -0.0207234751, 0.00456340937, 0.00991150644, 0.056240242, 0.0338316187, -0.0160024837, 0.0159253012, 0.0327253379, 0.0225629881, -0.0153978886, 0.0428619608, -0.035812635, 0.0306671411, 0.0041453382, 0.00679848297, -0.00872161146, 0.0229231734, -0.00487857079, 0.0114422906, -0.00973141473, 0.0626206547, -0.0141243795, 0.00190544047, 0.0131338714, -0.000668914116, 0.0129923709, 0.055982966, 0.0189868696, -0.0108698551, 0.0027062078, 0.015063432, 0.036507275, 0.0180349536, 0.042321682, 0.0186652765, 0.0140086059, -0.0142916078, -0.0185623672, -0.027039567, -0.0261776969, 0.00794978719, 0.0306414124, -0.0263706539, -0.032185059, 0.025959013, 0.0209807493, -0.0330855213, -0.0321336053, -0.0418071337, 0.00407780334, -0.00644473033, -0.00460200058, -0.00213377178, 0.00805912912, -0.0134426011, -0.0262034256, -0.0111592887, 0.013313964, 0.00625820644, -0.0102781225, -0.00310337567, -0.00780828623, -0.00834856275, 0.0388742, -0.00572114531, 0.0232833568, -0.00993723422, -0.00516478904, 0.0221256223, -0.0101816449, -0.0021064363, 0.0195528753, -0.0307443235, -0.00592374941, 0.00143993413, -0.0125678675, -0.0176747702, 0.0135841025, -0.0195271466, 0.036507275, 0.0217783, 0.00259365025, 0.0147675658, 0.013313964, 0.00959634501, 0.0161954407, 0.0145617463, 0.00900461338, 0.0359155424, -0.000103512852, 0.00340888929, -0.000359782542, 0.0301525909, -0.00688209757, -0.00885668, -0.0102909869, -0.001545256, 0.00473385397, -0.04378815, 0.035298083, 0.0345519893, -0.0400833935, 0.00117140368, 0.0329311565, -0.00958348159, 0.00582727138, 0.0352209024, 0.0354009941, 0.0138285132, -0.0191669632, 0.018369412, -0.00559250824, -0.00360184535, -0.0268852022, 0.0666855946, -0.00200031046, 0.0449458845, 0.0118539305, 0.0340888947, -0.0410353094, 0.0184723213, 0.0139185591, -0.0376907401, 0.0203504264, 0.0159896202, -5.30754619e-7, -0.0161697119, -0.00964136794, -0.0203247, 0.0166971255, -0.0225501247, 0.0215338897, -0.00971855, 0.0436852388, 0.00991793815, -0.0111657204, -0.0101880766, 0.0345005319, -0.00610705744, 0.0130180977, -0.0258818325, -0.0268080197, 0.00353431073, -0.0284031238, -0.0200031046, -0.0095899133, -0.0124392305, 0.00290398789, 0.0180606823, -0.00667627761, 0.0272453874, 0.0179449078, 0.054079134, 0.00582727138, 0.00951916259, -0.0069271205, 0.0296637695, -0.0251614619, -0.00458913669, -0.00635146815, 0.054079134, 0.0291234925, -0.0163755324, 0.0100980308, -0.0498855598, 0.0255216472, -0.00549924606, 0.0205948371, -0.00853508711, -0.00580475945, -0.0356068127, 0.0000674341, -0.0332913436, 0.00241677393, 0.0358898155, -0.00847076811, 0.00493324175, -0.02291031, -0.000932620664, 0.0209936127, -0.00798837841, -0.00282680546, 0.0626206547, 0.00401991652, 0.0556227826, 0.00346034416, 0.00449265866, 0.015822392, -0.00193116802, 0.00292971521, -0.0197072402, -0.0502457432, 0.00635790033, 0.0219841208, 0.0163112134, -0.0217139814, -0.0275283903, -0.00710721267, 0.0129409162, 0.0249813702, -0.00224311347, -0.0296380408, -0.0222028047, -0.0484190919, -0.00560537167, 0.0249427799, -0.00227527274, 0.00629679766, 0.0120726135, -0.0136226937, 0.0339859836, -0.00782758184, 0.0147547023, 0.000909305178, 0.00919756945, 0.0382310152, 0.0144073814, -0.0185237769, -0.0128444377, 0.0391829312, 0.00135953585, -0.0504515618, -0.000712731213, -0.00381088094, 0.019064052, -0.00458270498, -0.0141372429, -0.00472420594, 0.0234119948, 0.00242481381, -0.000898049388, -0.00545100681, -0.00614564866, 0.00543492753, 0.0524325781, -0.0161568485, 0.0130373938, 0.0415498577, 0.0140729239, -0.00968639087, 0.0636497512, 0.0106254434, 0.00214502751, -0.0310273245, -0.0139571503, 0.00576295238, -0.0087409066, -0.00240712613, -0.00454411376, -0.00773753552, -0.00569220213, 0.00746096531, 0.04041785, -0.0204790644, -0.0426304117, -0.0323908813, 0.0126579134, 0.0219841208, 0.011995431, -0.0144974273, 0.0105289659, 0.0233991314, 0.00986648351, 0.0170315821, -0.00824565347, -0.00926188845, -0.0222285315, -0.0108248312, -0.000050424831, 0.0297666788, -0.0144073814, 0.0414212197, -0.00405850774, -0.0194499642, 0.0415755846, -0.0186138228, -0.00196654326, 0.0034571283, 0.0043704533, 0.00853508711, -0.0124392305, 0.0167614445, 0.0040810192, -0.00501364, 0.0229746271, -0.00922329724, 0.0656050369, -0.00896602217, -0.00232512, 0.0391314775, -0.00141259877, 0.0207106099, -0.0112300394, 0.00487535493, 0.0142144253, -0.000207226709, 0.0090753641, -0.0266536549, -0.00458592083, -0.0348092616, -0.00868945196, 0.0179320443, 0.0317476951, 0.00796908326, -0.0172631294, 0.0216239356, -0.0228202622, 0.0174432229, -0.00926832, 0.00737735117, 0.00580797577, 0.0151792057, 0.0244410932, 0.0300754085, 0.00855438225, 0.00210322044, 0.0134811923, -0.00727444142, 0.0189354159, 0.0066376864, -0.0155779812, 0.0572178848, 0.00122768257, 0.00288790814, -0.0090625, 0.0100272801, 0.027039567, -0.027991483, -0.0205176547, -0.0106576029, -0.0161182582, -0.0355296321, -0.0220098477, -0.0230003558, -0.0141115151, 0.0162340309, 0.0588129908, -0.00932620652, 0.00298117031, -0.0246855039, -0.00284610107, 0.0159767568, -0.000869106, -0.0150762955, -0.00233959151, -0.0429391414, -0.000211447623, 0.0165041704, 0.00794978719, 0.0161825772, -0.0199902412, 0.00199548667, 0.0212380234, 0.0313360542, -0.00902390853, 0.0242481381, -0.00339602563, 0.019797286, -0.00426111184, -0.00960920844, -0.0327253379, -0.00270138402, 0.0232962202, -0.0147804292, -0.00312588713, 0.043659512, -0.00180574658, 0.00659909518, -0.0368417315, -0.00159429898, 0.0154879354, -0.00489465054, 0.0300239529, 0.00794978719, -0.00904963631, -0.00459235301, -0.00532880146, 0.00489465054, -0.0209292937, -0.0113522448, 0.00649940129, 0.00799481, 0.0179963633, 0.0597391762, -0.0267308373, -0.0170315821, 0.0163240768, 0.0182279106, -0.025740331, -0.00318699, 0.00389771117, -0.011693134, 0.0200931523, 0.0154622076, -0.00432221452, 0.0453575253, 0.0103810327, -0.0302555, 0.0102459639, 0.0145746097, 0.0285574887, -0.0310015976, -0.00401348481, -0.0038655519, -0.000554346538, -0.0430935062, 0.0501428321, 0.00290720374, 0.0457691625, -0.0241580904, -0.0105611254, -0.0245311391, 0.0348349884, -0.034217529, -0.00548638217, -0.000401991681, 0.0148447482, -0.0311816894, -0.0397489369, -0.0014190306, -0.0141501063, 0.0184851848, 0.00757030724, -0.0118089076, 0.0400576666, -0.0000445959522, -0.00640613912, 0.0199516509, 0.0490622781, -0.0359927267, -0.00587872602, 0.0157452095, 0.00798194669, 0.0229360368, -0.0315418728, -0.0110435151, -0.0244925488, 0.00600736355, -0.0220355745, -0.00556034874, 0.0149862496, -0.00453768205, -0.0131531674, 0.0310530532, 0.00851579104, -0.0113007901, -0.00691425661, -0.000391740876, 0.00226401701, 0.00356968609, 0.00257113879, 0.00950629916, -0.0160410758, 0.00703646196, 0.0190383252, 0.026756566, 0.033265613, 0.047055535, 0.0357354507, -0.0402120315, 0.0211865697, -0.0256631486, 0.0219326653, 0.0147289746, -0.0341918021, -0.0289691277, 0.0225758515, -0.00276570278, -0.00306478445, 0.0207749289, 0.0581955314, 0.00859297346, 0.0445599742, -0.0121948188, -0.0139314234, -0.0348092616, 0.0303584114, -0.0110563785, -0.00248913234, 0.0175332688, -0.0060588182, -0.0181893185, 0.0000830615318, 0.0102588274, -0.0507602915, -0.00418714527, 0.0204790644, 0.0150762955, -0.0155651178, -0.0027287195, 0.00915254653, 0.0172502659, -0.011693134, -0.000995331327, -0.00865086075, -0.00597842, -0.0186910052, -0.0291234925, 0.00434794184, -0.0139056956, 0.00824565347, 0.0361728184, -0.00216110726, -0.0148962028, 0.0423731394, -0.00468561472, 0.0283773951, 0.0098600518, -0.0165813528, -0.00349571952, 0.0176490415, -0.00279464596, 0.0267308373, 0.00254058745, -0.0306671411, -0.0438138768, -0.0104453517, -0.0304613207, 0.0143173356, 0.00410353113, 0.0244025029, -0.00287343655, 0.0107540814, -0.00442190841, -0.0257146023, -0.00127913745, 0.00587551, -0.0424245931, 0.00603309087, -0.00131049287, 0.0135712391, -0.0157066192, 0.0125614358, 0.0305385031, 0.00154606, -0.032699611, 0.036764551, 0.00108457357, 0.0261648335, -0.0118989535, 0.0248913243, 0.0109277414, 0.0143559268, -0.00315965456, -0.00766035309, -0.020620564, 0.0133268274, 0.0337544382, -0.00452803401, -0.0146260653, 0.00217075506, 0.0160668027, 0.0137513308, -0.0030294091, -0.0129666431, -0.0135455113, 0.0429905951, 0.0160024837, 0.0236949977, 0.0098600518, -0.0364558212, -0.000322799315, 0.0136226937, -0.0152949793, 0.0143559268, 0.0226787627, 0.00945484359, -0.00371761899, -0.0468239896, 0.00633860473, 0.0445857]

export async function POST(req) {
    const pc = new Pinecone({
        apiKey: process.env.PINECONE_API_KEY,
    });

    const openai = new OpenAI({
        apiKey: process.env.OPENAI_API_KEY,
    });

    try {
        const { code_name, questions } = await req.json();
        console.log("Fetching RAG data for code_name:", code_name);
        //console.log("Received questions:", questions);

        if (!Array.isArray(questions)) {
            throw new Error('Questions must be an array');
        }

        const index = pc.Index("rag");
        //const indexDescription = await pc.describeIndex("rag");
        //console.log("Index Description:", indexDescription);
        

        const ragData = [];

        for (const question of questions) {
            console.log(question.question)
            const questionEmbedding = await openai.embeddings.create({
                input: question.question,
                model: "text-embedding-3-small"
            });
            //console.log(questionEmbedding)
            //console.log(typeof code_name)

            const statsResponse = await index.describeIndexStats({
                filter: { namespace: code_name }
            });
            //console.log("Namespace stats:", statsResponse);

            const queryResult = await index.namespace(code_name).query({
                topK: 10, // Reduced from 15 to 5 for efficiency
                includeMetadata: true,
                vector: questionEmbedding.data[0].embedding,
            });

            //console.log("Question embedding dimension:", questionEmbedding.data[0].embedding);
            //console.log(queryResult)

            const relevantData = queryResult.matches.map(match => ({
                id: match.id,
                text: match.metadata.text || '',
                pdf_name: match.metadata.pdf_name || '',
                page_num: match.metadata.page_num || '',
                similarity: match.score,
                questionId: question.id
            }));

            ragData.push(...relevantData);
        }

        console.log(`Retrieved ${ragData.length} relevant RAG data items for ${code_name}`);
        return new Response(JSON.stringify(ragData), {
            headers: { 'Content-Type': 'application/json' },
        });
    } catch (error) {
        console.error('Error fetching RAG data from Pinecone:', error);
        return new Response(JSON.stringify({ error: 'Failed to fetch RAG data', details: error.message }), {
            status: 500,
            headers: { 'Content-Type': 'application/json' },
        });
    }
}